
/**
 * Powermail setup
 */
plugin.tx_powermail {

	view {
		templateRootPath = EXT:adx_twitter_bootstrap/Resources/Private/Templates/Powermail/2.0.0/Templates/
		partialRootPath = EXT:adx_twitter_bootstrap/Resources/Private/Templates/Powermail/2.0.0/Partials/
		layoutRootPath = EXT:adx_twitter_bootstrap/Resources/Private/Templates/Powermail/2.0.0/Layouts/
	}
}

lib.tx_adxtwitterbootstrap {

	powermail {

		fieldsetClasses = COA
		fieldsetClasses {

			10 = TEXT
			10.field = offset
			10.fieldRequired = offset
			10.noTrimWrap = | offset||

			20 = TEXT
			20.field = span
			20.fieldRequired = span
			20.noTrimWrap = | span||
		}

		fieldClasses < .fieldsetClasses

		itemClasses = COA
		itemClasses {
			10 = TEXT
			10.value = {$plugin.tx_adxtwitterbootstrap.variables.gridColumns}
			10.fieldRequired = span
			10.noTrimWrap = | span||
		}

		fieldsetRowStartTag = COA
		fieldsetRowStartTag {

			# Start the row class if counter is empty.
			10 = TEXT
			10 {
				value = <div class="row-fluid">
				if.isFalse.data = register: countSpan
			}

			# Add current span value to total columns.
			20 = LOAD_REGISTER
			20.countSpan.stdWrap.dataWrap = {field: span} + {field: offset} + {register: countSpan}
			20.countSpan.prioriCalc = 1

			# Reset counter if total columns reached.
			30 = TEXT
			30 {
				if.value = {$plugin.tx_adxtwitterbootstrap.variables.gridColumns} - 1
				if.value.prioriCalc = 1

				if.isGreaterThan.data = register: countSpan

				append = LOAD_REGISTER
				append.countSpan = 0
			}
		}

		# Close row if counter is empty.
		fieldsetRowEndTag = TEXT
		fieldsetRowEndTag {
			value = </div>
			if.value = 0
			if.isGreaterThan.data = register: countSpan
			if.isFalse.field = isLast
			if.negate = 1
		}

		controlsRowStartTag = COA
		controlsRowStartTag {

			# Start the row class if counter is empty.
			10 = TEXT
			10 {
				value = <div class="control-group clearfix">
				if.isFalse.data = register: countControlSpan

				override = <div class="control-group clearfix">
				override.if.value = columnFull,columnHalfSingleRow,columnThirdSingleRow,columnTwoThirdSingleRow,columnQuarterSingleRow,columnTwoQuarterSingleRow,columnThreeQuarterSingleRow
				override.if.isInList.field = css
			}

			# Add current span value to total columns.
			20 = LOAD_REGISTER
			20.countControlSpan.stdWrap.dataWrap = {field: span} + {field: offset} + {register: countControlSpan}
			20.countControlSpan.prioriCalc = 1

			# Reset counter if total columns reached.
			30 = TEXT
			30 {
				if.value = {$plugin.tx_adxtwitterbootstrap.variables.gridColumns} - 1
				if.value.prioriCalc = 1

				if.isGreaterThan.data = register: countControlSpan
				if.isGreaterThan.override = {$plugin.tx_adxtwitterbootstrap.variables.gridColumns}
				if.isGreaterThan.override.if.value = columnFull,columnHalfSingleRow,columnThirdSingleRow,columnTwoThirdSingleRow,columnQuarterSingleRow,columnTwoQuarterSingleRow,columnThreeQuarterSingleRow
				if.isGreaterThan.override.if.isInList.field = css

				append = LOAD_REGISTER
				append.countControlSpan = 0
			}
		}

		# Close row if counter is empty.
		controlsRowEndTag = TEXT
		controlsRowEndTag {
			value = </div>
			if.value = 0
			if.isGreaterThan.data = register: countControlSpan
			if.isFalse.field = isLast
			if.negate = 1
		}
	}
}